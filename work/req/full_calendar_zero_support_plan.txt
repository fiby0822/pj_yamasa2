学習・推論モジュール改修方針（ゼロ実績・全日付対応）
================================================================

背景と要件
- 元データでは実績が発生した日しかレコード化されていないが、ビジネス上は実績ゼロも有効な観測であり、学習データに欠落させるべきではない。
- 予測結果は対象月の全日付（営業日・非営業日を問わず）で提供する必要があり、ゼロ需要を含めて予測値を算出する。
- 現行モジュールは欠損日を補完せず、予測も実績が存在する日付に限定しているため、日次カバレッジとゼロ予測が不十分。

改修対象
- `work/script/prepare_product_level_data_local.py`
- `work/script/generate_features_product_level.py`
- `work/script/train_model_product_level.py`
- 付随スクリプト（`save_results_csv.py`, `visualize_predictions.py`, `train_and_save_product_level.py`）

改修方針
1. データ準備段階での日次カレンダー生成
   - `prepare_product_level_data_local.py` で素材×日付の完全カレンダーを構築。最小日付〜最大日付を日次で展開し、欠損日は `actual_value=0` として補完。
   - 営業日フラグなど基本的なカレンダー特徴を同時に付与し、後段で再利用できるようにする。
   - ゼロ補完済みデータを `..._fill_zero.parquet` として保存し、元データは別ファイルに保持して差分検証を可能にする。

2. 特徴量生成の更新
   - FeatureState は補完後の連続日次データを前提とし、ゼロを含む値列からラグ・ローリング・EMA を計算。欠損補完と観測の区別は行わない。
   - カレンダー特徴（曜日・祝日・営業日など）をゼロ補完済みデータに基づき一貫して計算する。
   - 長期のゼロ継続を示すため `days_since_last_positive` などの派生特徴を追加し、需要低迷期の予測を安定化させる。

3. 推論ロジックの拡張
   - 予測は「学習終了日の翌日から予測対象月の末日まで」を範囲とし、全日付に対して FeatureState を進めながら予測する。
   - 未確定実績の日付は `actual=0` で保持し、後工程の評価時に正しい実績が入った時点で置き換えられる前提とする。
   - 月次再スケーリング/減衰ロジックは今後の課題として保持しつつ、ゼロを多く含む場合でも安定するよう正則化を調整。

4. メトリクス・可視化・CSV出力の対応
   - 精度算出はゼロ実績日も含めて行う。WAPE や RMSE はゼロを含む実績ベクトルに対して計算し、MAPE はゼロ除外ではなく epsilon を加えるなどして安定化させる。
   - `visualize_predictions.py` は日次全件を前提に、ゼロ実績もグラフ上で明確に表示する（マーカーを地に表示するなど）。
   - CSV 出力 (`save_results_csv.py`) も全日付行を維持し、ウォッチリスト用の集計にゼロ予測が反映されるようにする。

5. 検証計画
   - 代表商品（高頻度/低頻度/季節性）で日次連続性とゼロ実績表示を確認。
   - 学習・検証期間を通してゼロ実績を含むスコア（MAPE/WAPE/MAE）の変化を評価。
  - グラフ確認：A01101A などで連続日次が描画され、ゼロ値がグラフ上に現れることを目視確認。
